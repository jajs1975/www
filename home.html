<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <link rel="stylesheet" href="lib/jquery/css/jquery.mobile-1.4.4.min.css">
    <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="lib/owl-carousel/owl.carousel.css" rel="stylesheet">
    <link href="lib/owl-carousel/owl.theme.css" rel="stylesheet">
    <link rel="stylesheet" href="css/spribo.css">
    
    
</head>
<body>
    <div data-role="page" id="pageone" class="ui-responsive-panel" data-title="SPRIBO MOBILE">
        <div data-role="panel" data-position-fixed="true" id="myPanel" data-dismissible="false" data-display="reveal" data-position="left">
            <div data-role="listview" class="nav-search">
                <div class="userInfo" id="loggedUser">
                    <ul class="nav nav-pills nav-stacked">
                        <li>
                            <a href="to_attrDetail.html"  id="username" onclick="setPath('home');getUserInfo(); insertHtml(this.href); this.blur(); return false;" data-ajax="true"> <!--  style="text-shadow: none !important;padding: 5px 5px;" -->
                                <span class="text-menu side-menu-item"></span><!--   style="color:#FFF;" -->
                            </a><hr>
                        </li>
                        <li>
                            <a href="to_UserInstances.html" onclick="setPath('home');insertHtml(this.href); this.blur(); return false;" data-ajax="true"> <!--  style="text-shadow: none !important;padding: 5px 5px;" -->
                                <img src="img/contacts_focus_48dp.png">  <!--  style="width:20px;height:20px" -->
                                <span class="text-menu side-menu-item">Contactos</span><!--   style="color:#FFF;" -->
                            </a><hr>
                       </li>
                    </ul>
                </div>
                <div class="objTypes"></div> 
            </div><!-- /nav-search-->
        </div><!-- /myPanel -->
        <!--myPanel-->
        <div data-role="header" id="pageHeader" data-position="fixed" data-tap-toggle="false" class="headerFooterColor">
            <a id="icon-bars" href="#" class="ui-icon-alt iconsSpribo" data-icon="bars" data-iconpos="notext" data-inline="true" onclick="backIcon();">Menu</a>
            <h1 class="page-title"></h1>
            <h1 id="subtitle" class="page-subTitle">Información</h1> <!--  style="display:none" -->
            <a id="action-icon-right" href="to_InstanceInfo.html" onclick="insertHtml(this.href); this.blur(); setPath('to_attrDetail');return false;" class="ui-icon-alt hide-action-icon-right iconsSpribo" data-icon="info" data-iconpos="notext" data-inline="true" rel="external" data-ajax="false">Info</a>
        </div><!-- /header -->
        
        <div class="modal fade" id="dialogComent" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true" onclick="cleanForm();">
            <div class="modal-dialog"> <!--  style="height:50%;width:100%;margin:0px" -->
                <div class="modal-content"> <!--  style="background-color:transparent; height:100%; width:100%;box-shadow: 0 0px 0px rgba(0,0,0,0);border:2px" -->
                    <div> <!--  style="padding-bottom:0px;padding:0px" -->
                        <div class="row">
                            <div class="col-xs-3 modal-content-left"> <!--  style="text-align:left;" -->
                                <a class="btn objectName" data-dismiss="modal" onclick="cleanForm();">cancelar</a>
                            </div>
                            <div class="col-xs-6">
                                <div id="userNameModal" class="page-title text-center"></div>
                            </div>
                            <div class="col-xs-3 modal-content-right"> <!--  style="text-align:right;" -->
                                <a class="btn objectName" data-dismiss="modal" onclick="sendPost(document.getElementById('shareIdeas').value);cleanForm();">enviar</a>
                            </div>
                        </div>
                    </div>
                    <div class="modal-body"> <!--  style="height:80%;position:relative;padding-left:5px; padding-right:5px;padding-top:1px; outline: none;" -->
                        <div class="row"> <!--  style="height:100%;position:relative; padding:0px" -->
                            <div class="col-xs-12 no-float"> <!--  style="height:100%;position:relative; padding:0px" -->
                                <textarea rows="6" id="shareIdeas" class="clsTextArea" placeholder="Comparte tus ideas..."></textarea> <!--  style="height:100%" -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="maincontent" data-role="main" class="ui-content">
        </div> 
        <div data-role="footer" data-position="fixed" data-tap-toggle="false" class="ui-bar headerFooterColor">
            <a href="newsFeedCommunity.html" class="ui-icon-alt footeranchor iconsSpribo iconsScribo1" data-icon="home" data-iconpos="top" data-inline="true" onclick="home(); insertHtml(this.href); this.blur(); return false;">Inicio</a>
        </div><!-- /footer -->
    </div>
	
	<script src="lib/jquery/js/jquery-1.11.0.js"></script>
    <script src="lib/jquery/js/jquery.mobile-1.4.4.min.js"></script>
    <script src="lib/bootstrap/js/bootstrap.min.js"></script>
    <script src="lib/handlebars/js/handlebars.js"></script>
    <script src="lib/owl-carousel/owl.carousel.js"></script>
    <script type='text/javascript' src='lib/foggy/jquery.foggy.min.js'></script>
    <script id="obj-list-tpl" type="text/template">  
        <ul class="nav nav-pills nav-stacked">
            {{#each this}}
            <li>
                <a href="to_Instances.html" onclick="setPath('home');setObjId('{{Id}}', '{{Name}}'); insertHtml(this.href); this.blur(); return false;" data-ajax="true"> <!--  style="text-shadow: none !important;padding: 5px 5px;" -->
                <span class="text-menu side-menu-item">&nbsp;{{Name}}</span> <!--  style="color:#FFF;" -->
                </a><hr>
            </li>
            {{/each}}
        </ul>   
    </script> 
    <script id="newsFeedCommunityTem" type="text/template">
        {{#eachNeewsFeed this}}
        {{/eachNeewsFeed}}
    </script>
    <script src="js/newsFeedCommunity.js"></script>
    <!--script src="lib/handlebars.js"></script-->
    <script src="cordova.js"></script>
    <script src="lib/fastclick/fastclick.js"></script>
    <script src="js/home.js"></script>

</body>
</html>

<script>
$(document).on('pagebeforeshow', '#pageone', function(){

});

$(document).ready(function() {
	$("#pageone").swipeleft(function() {
		console.log('swipeleft');
		$( "#myPanel" ).panel( "close" );
	});  
	$("#pageone").swiperight(function() {
	  console.log('swiperight');
	  $( "#myPanel" ).panel( "open" );
	});  
		
	if (window.innerWidth >= 768) {
		openPanel();
	}
	if (window.innerWidth < 768) {
		closePanel();
	}
});
	
window.onresize = function (event) {
	if (window.innerWidth >= 768) {
		window.setTimeout(openPanel, 1);
	}
	if (window.innerWidth < 768) {
		window.setTimeout(closePanel, 1);
	}
};

function closePanel() {
	$("#myPanel").panel("close");
}
function openPanel() {
	$("#myPanel").panel("open");
}

function setObjId(param, param2) {
    if(param != null) window.localStorage["objectId"]=param;
	if(param2 != null) window.localStorage["objectName"]=param2;
}

function setPropId(param1, param2, param3) {
	var objInstanceId = window.localStorage["objInstanceId"];
    if(objInstanceId != undefined) {
		objInstanceId += param1 + "|";
    } else {
		objInstanceId = param1 + "|";
    }
    window.localStorage["objInstanceId"] = objInstanceId;
	
	var objInstanceName = window.localStorage["objInstanceName"];
    if(objInstanceName != undefined) {
		objInstanceName += param2 + "|";
    } else {
		objInstanceName = param2 + "|";
    }
    window.localStorage["objInstanceName"] = objInstanceName;
	
	var objInstanceType = window.localStorage["objInstanceType"];
    if(objInstanceType != undefined) {
		objInstanceType += param3 + "|";
    } else {
		objInstanceType = param3 + "|";
    }
    window.localStorage["objInstanceType"] = objInstanceType;
}

function setAttrId(param1, param2, param3, param4, param5) {
	var attriId = window.localStorage["attrId"];
    if(attriId != undefined) {
		attriId += param1 + "|";
    } else {
		attriId = param1 + "|";
    }
    window.localStorage["attrId"] = attriId;
	
	var attrName = window.localStorage["attrName"];
    if(attrName != undefined) {
		attrName += param2 + "|";
    } else {
		attrName = param2 + "|";
    }
    window.localStorage["attrName"] = attrName;
	
	var attrDisplayImage = window.localStorage["attrDisplayImage"];
    if(attrDisplayImage != undefined) {
		attrDisplayImage += param3 + "|";
    } else {
		attrDisplayImage = param3 + "|";
    }
    window.localStorage["attrDisplayImage"] = attrDisplayImage;
	
	var attrCoverImage = window.localStorage["attrCoverImage"];
    if(attrCoverImage != undefined) {
		attrCoverImage += param4 + "|";
    } else {
		attrCoverImage = param4 + "|";
    }
    window.localStorage["attrCoverImage"] = attrCoverImage;
	
	var attrType = window.localStorage["attrType"];
    if(attrType != undefined) {
		attrType += param5 + "|";
    } else {
		attrType = param5 + "|";
    }
    window.localStorage["attrType"] = attrType;
}

function getInstData(attr, isBack) {
	var attribute = window.localStorage[attr];
	var strData = attribute.split("|");
	var current = "";
	if (strData.length > 1) {
		current = strData[strData.length -2];
		if(isBack) {
			attribute = attribute.substring(0,(attribute.length - (current.length+1)));
		}
	} else {
		current = "";
	}
	if(isBack) {
		window.localStorage[attr] = attribute;
	}
	return current;
}

function getAttrData(attr, isBack) {
	var attribute = window.localStorage[attr];
	var strData = attribute.split("|");
	var current = "";
	if (strData.length > 1) {
		current = strData[strData.length -2];
		if(isBack) {
			attribute = attribute.substring(0,(attribute.length - (current.length+1)));
		}
	} else {
		current = "";
	}
	if(isBack) {
		window.localStorage[attr] = attribute;
	}
	return current;
}

function insertHtml(targetUrl) {
console.log(targetUrl +"-->");
	//alert('url a ejecutar: ' + targetUrl)
	//ocultar siempre el icono de informacion. En el html que se carga se muestra cuando aplica(instance_detail.html)
	$("#action-icon-right").addClass("hide-action-icon-right");
	
	var isMenu = false;
	if(targetUrl.indexOf("newsFeedCommunity") < 0 && targetUrl.indexOf("home") >= 0){
		isMenu = true;
		document.getElementById('icon-bars').href = "#";//"#myPanel"
	} 
	if(targetUrl.indexOf("newsFeedCommunity") >= 0 && targetUrl.indexOf("home") < 0){
		 isMenu = true;
		 document.getElementById('icon-bars').href = "#"; //"#myPanel"
	}
	if(!isMenu) { 
    	$('#icon-bars').removeClass("ui-icon-bars");
    	$("#icon-bars").addClass("ui-icon-carat-l");
    	$('#icon-barS').attr("data-icon","carat-l");
    } 
	$( "#myPanel" ).panel( "close" );

	var request = $.ajax({
	  url: targetUrl,
	  type: "GET",
	  dataType: "html",
	});
	 
	request.done(function( msg ) {
		console.log('success!!');
		//alert('Msg: '  + msg);
		$("#maincontent").html(msg);
		//alert(document.getElementById('maincontent').innerHTML);
		$("#maincontent").removeClass("displayListview");
	});

	request.fail(function( jqXHR, textStatus ) {
	  alert( "Request failed: " + textStatus );
	});
}

function backIcon() {
	if($('#icon-bars').hasClass("ui-icon-bars" )) {
	    if( $("#myPanel").hasClass("ui-panel-open") == true ){
		   closePanel();
        }else{
			openPanel();
        }
	} else {
		var attribute = window.localStorage['path'];
		var strData = attribute.split("|");
		var current = "";
		if (strData.length > 1) {
			current = strData[strData.length -2];
			attribute = attribute.substring(0,(attribute.length - (current.length+1)));
		} else {
			current = "home";
			attribute = "";
		}
		window.localStorage['path'] = attribute;

		if(current == "home") {
			$('#icon-bars').addClass("ui-icon-bars");
			$("#icon-bars").removeClass("ui-icon-carat-l");
			$('#icon-barS').attr("data-icon","bars");
			document.getElementById('icon-bars').href = "#";//"#myPanel"
			$( '.ui-header .ui-title' ).css( "padding","0.7em 0" );
			var commName=window.localStorage["commName"];
			if (commName == undefined) commName = "";
			$('.page-title').html(commName);
		}
		if ($("#to_instanceInfo").html() != undefined && $("#to_instanceInfo").html() != '') {
			$('#subtitle').hide();
			$( '.ui-header .ui-title' ).css( "padding","0.7em 0" );
		}
			
		if ($("#vp_display").html() != undefined && $("#vp_display").html() != '') {
			$('#subtitle').html("Información");
		} 
			
		if ($("#to_instanceObjectList").html() != undefined && $("#to_instanceObjectList").html() != '') {
			$('#subtitle').html("Información");
		}
		if ($("#to_attrDetail").html() != undefined && $("#to_attrDetail").html() != '') {
			getAttrData('attrId', true);
			getAttrData('attrName', true);
			getAttrData('attrCoverImage', true);
			getAttrData('attrDisplayImage', true);
			getAttrData('attrType', true);
		}
		
		if ($("#to_AttrInfo").html() != undefined && $("#to_AttrInfo").html() != '') {
			document.getElementById('action-icon-right').href = "javascript:insertHtml('to_InstanceInfo.html')";
		}
		
		if ($("#instanceObjectList").html() != undefined && $("#instanceObjectList").html() != '') {
			getInstData('objInstanceId', true);
			getInstData('objInstanceName', true);
			getInstData('objInstanceType', true);
		}
		var strPath = location.href.lastIndexOf("/");
		var urlRed = location.href.substring(0,strPath);
		insertHtml(urlRed + '/' + current + '.html');
		//document.getElementById('icon-bars').href = current + ".html";//"javascript:insertHtml('" + current + ".html')";
		
	}
}

function home(){
	$('#maincontent').empty();
	$('#icon-bars').addClass("ui-icon-bars");
	$("#icon-bars").removeClass("ui-icon-carat-l");
	$('#icon-barS').attr("data-icon","bars");
	//$( "#myPanel" ).panel( "open" );
	$('#subtitle').hide();
	setPath('home');
	$( '.ui-header .ui-title' ).css( "padding","0.7em 0" );
	
	var commName=window.localStorage["commName"];
	if(commName==undefined) commName = "";
    $('.page-title').html(commName);
}
function setPath (page) {
   var path = window.localStorage["path"];
   var object = [];
   if(path != undefined && page != 'home') {
		path += page + "|";
   } else {
		path = page + "|";
		window.localStorage["attrId"] = "";
		window.localStorage["attrName"]="";
		window.localStorage["attrType"]="";
		window.localStorage["attrCoverImage"]="";
		window.localStorage["attrDisplayImage"]="";
		window.localStorage["objInstanceId"]="";
		window.localStorage["objInstanceName"]="";
		window.localStorage["objInstanceType"]="";
   }
   window.localStorage["path"] = path;
}
function setListType(type) {
    if (type) window.localStorage["listType"]=type;
}
function getFoggy() {
	$('#maincontent').foggy({
		blurRadius: 8,
		opacity: 0.5,
		cssFilterSupport: true 
	});
	$('#pageHeader').foggy({
		blurRadius: 8,
		opacity: 0.5,
		cssFilterSupport: true 
	});
	$('#shareIdeas').click(function(event){
		event.stopPropagation();
	}
	);
}

function sendPost(post) {
    var attrId=getAttrData("attrId", false);
	var authorization = window.localStorage["Authorization"];
	var userId=window.localStorage["userId"];
	var formData = "";
	var isValid = false;
	if(attrId != userId) {
		formData = {spriboId: attrId ,post: post,authorizationToken:authorization};
		isValid = authorization != undefined && authorization != null && post != undefined && post != null && post.length > 0;
	} else {
		formData = {post: post,authorizationToken:authorization};
		isValid = authorization != undefined && authorization != null && post != undefined && post != null && post.length > 0 && attrId != undefined && attrId != null;
	}
	
	if(isValid) {
		$.ajax({
			type: 'POST',
			url: "http://" + urlComm + ".spribo.qoslabs.com/spribo/api/postOnUserWall",
			data : formData,
			dataType: "text"
		}).done(function(object) {
			insertHtml('to_attrDetail.html');
		}).fail(function(param1, param2, param3) {
			insertHtml('to_attrDetail.html');
		});
	}
}
function cleanForm() {
	$('#maincontent').foggy(false);
	$('#pageHeader').foggy(false);
	document.getElementById('shareIdeas').value='';
}
function addModal() {
    if ($('#modalLive').length == 0) {
        var addedModal = '<div class="modal fade" id="modalLive" tabindex="-1" role="dialog" aria-labelledby="modalLiveLabel" aria-hidden="true" onclick="quitModal();">';
        addedModal += '<div class="modal-dialog modalAlert-dialog"><div class="modal-content modalAlert-content">';
        addedModal += '<div id="modalHeader" class="modal-header modalAlert-header"><h4 class="modal-title" id="modalLiveLabel"></h4></div>';
        addedModal += '<div id="modalBody"  class="modal-body modalAlert-body"><span></span></div>';
        addedModal += '<div class="modal-footer modalAlert-footer"><hr style="border-color:#d2d2d2;"><div class="modalAlert-btn" data-dismiss="modal" onclick="quitModal();">OK</div></div>';
        addedModal += '</div></div></div>';
        $('#pageone').append(addedModal);
        $('#modalHeader').click(function(event) {
            event.stopPropagation();
        });
        $('#modalBody').click(function(event) {
            event.stopPropagation();
        });
    }
    if ($('#actionSheet').length == 0) {
        var addedAS = '<div class="modal fade" id="actionSheet" tabindex="-1" role="dialog" aria-labelledby="actionSheetLabel" aria-hidden="true" onclick="quitModal();" data-dismiss="modal">';
        addedAS += '<div class="modal-dialog modalAS-dialog"><div class="modal-content modalAlert-content">';
        addedAS += '<div id="actionSheetHeader" class="modal-header modalAlert-header" data-dismiss="modal"><h4 class="modal-title" id="actionSheetLabel"></h4></div>';
        addedAS += '<div id="actionSheetBody" class="modal-body modalAlert-body" data-dismiss="modal"><span></span></div>';
        addedAS += '<div class="modal-footer modalAlert-footer"><div id="innerFooter"><div class="separation"><button type="button" class="btn btn-ASprimary" data-dismiss="modal" onclick="disconnectFrom();">Eliminar de mis contactos</button></div>';
        addedAS += '<div class="separation"><button type="button" class="btn btn-ASdefault" data-dismiss="modal" onclick="quitModal();">Cancelar</button></div>';
        addedAS += '</div></div></div></div>';
        $('#pageone').append(addedAS);
        /*
        $('#actionSheetHeader').click(function(event) {
            event.stopPropagation();
        });
        $('#actionSheetBody').click(function(event) {
            event.stopPropagation();
        });*/
    }
}
function quitModal() {
    $('#maincontent').foggy(false);
    $('#pageHeader').foggy(false);
}
</script>
